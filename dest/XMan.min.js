/*! xMan 2015-11-12 */
!function(a){"use strict";if("object"==typeof exports&&"undefined"!=typeof module)module.exports=a();else if("function"==typeof define&&define.amd)define([],a());else{var b;if("undefined"==typeof window)throw new Error("wrong execution environment");b=window,b.x=a()}}(function(){"use strict";var a=window.console||{log:function(){},warn:function(){},info:function(){}},b=function(a){return function(b){return Object.prototype.toString.call(b)==="[object "+a+"]"}},c={encodeObject2URIString:function(a){if("string"==typeof a)return a;var b=[];for(var c in a)a.hasOwnProperty(c)&&"function"!=typeof a[c]&&b.push(encodeURIComponent(c)+"="+encodeURIComponent(a[c]));return b.join("&")},stringify:function(a){var b=typeof a,d=c.stringify;if("object"!==b||null===a)return"string"===b&&(a='"'+a+'"'),String(a);if("object"==typeof JSON&&JSON.stringify)return JSON.stringify(a);var e,f=[],g=a&&a.constructor===Array;for(var h in a)a.hasOwnProperty(h)&&(e=a[h],b=typeof e,"string"===b?e='"'+e+'"':"object"===b&&null!==e&&(e=d(e)),f.push((g?"":'"'+h+'":')+String(e)));return(g?"[":"{")+String(f)+(g?"]":"}")},parseJSON:function(a){var b=/^[\],:{}\s]*$/,c=/\\(?:["\\\/bfnrt]|u[0-9a-fA-F]{4})/g,d=/"[^"\\\n\r]*"|true|false|null|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?/g,e=/(?:^|:|,)(?:\s*\[)+/g;return"object"==typeof a?a:"string"==typeof a&&a?(a=a.replace(/(^\s+)|(\s+$)/g,""),b.test(a.replace(c,"@").replace(d,"]").replace(e,""))?window.JSON&&window.JSON.parse?window.JSON.parse(a):new Function("return "+a)():a):null},bind:function(a,b){return Function.prototype.bind?a.bind(b):function(){a.apply(b,arguments)}},hasSearch:function(a,b){var c="";return c=/\?/.test(a)?"&":"?",a+c+b},forIn:function(a,b){if(c.isObject(a))for(var d in a)a.hasOwnProperty(d)&&b.call(null,d,a[d])},iteral:function(a,b){return c.isArray(a)?c.each.apply(null,[a,b]):c.isObject(a)?c.forIn.apply(null,arguments):void 0},each:function(){return[].forEach?function(a){[].forEach.apply(a,[].slice.call(arguments,1))}:function(a,b){for(var c=0,d=a.length;d>c;c++)b.call(arguments[2],a[c],c,a)}}(),init:function(){c.each(["Object","String","Function","Array"],function(a){c["is"+a]=b(a)})},isPureObject:function(a){return!(!c.isObject(a)||a.constructor!==Object)}};c.init();var d=function(){this.obtainId=function(){var a=0;return function(b){return(b||"obtainId_")+a++}}(),this.queue={}};d.prototype.getJsonp=function(){var a=this;return function(b,d,e,f){var g="cb"+a.obtainId(),h="window.x."+g,i=document.createElement("script");window.x[g]=function(a){try{f(a)}finally{delete window.x[g],i.parentNode.removeChild(i)}};var j="";c.isObject(d)&&(j=c.encodeObject2URIString(d)),j+=j.length>0?"&":"",i.src=c.hasSearch(b,j+e+"="+h),document.body.appendChild(i)}},d.prototype.getCORS=function(b){var d=function(){return"XMLHttpRequest"in window?"withCredentials"in new XMLHttpRequest?XMLHttpRequest:"XDomainRequest"in window?window.XDomainRequest:null:!1}();return function(b,e,f,g,h){if(a.info("使用此方法必须服务器端配合.\n1:在响应头中加上Access-Control-Allow-Origin\n2:需要前端携带凭据的话,则后端必须加上Access-Control-Allow-Credentials:true\n3:如果需要自定义头信息则响应头必须加上Access-Control-Request-Headers和Access-Control-Allow-Headers\n详情请参考http://www.w3.org/TR/cors/"),!d)return void a.warn("[WARN] 当前浏览器支持此功能,请常识其他方式进行跨域请求.");c.isPureObject(f)&&(f=c.encodeObject2URIString(f)),"get"===String(b).toLowerCase()&&c.isString(f)&&f.length>0&&(e=c.hasSearch(e,f),f=void 0),h=h||{};var i=new d;i.open(b,e),c.forIn(h.headers,function(a,b){i.setRequestHeader(a,b)}),i.withCredentials=!!h.withCredentials,i.onload=function(){g(i.responseText)},i.send(f)}},d.prototype.getFrame=function(){return function(a){return new e(a)}},d.prototype.createIframe=function(a){var b=null,c=this;try{b=document.createElement("<iframe name='"+a+"'>")}catch(d){b=document.createElement("iframe")}b.name=a,b.style.display="none",document.body.appendChild(b),b.onload=function(){var a=c.queue[b.name];if(a)try{a(b.contentWindow.name)}finally{b.parentNode.removeChild(b),delete c.queue[b.name]}}},d.prototype.getFrameForm=function(){var a=null,b=this;return function(d,e,f,g,h){null===a&&(a=document.createElement("form"),document.body.appendChild(a));var i=b.obtainId();b.createIframe(i),a.method=d,a.enctype=h||"application/x-www-form-urlencoded",a.setAttribute("target",i),a.action=e,b.queue[i]=g,a.innerHTML="",c.forIn(f,function(b,c){var d=document.createElement("input");d.type="hidden",d.name=b,d.value=c,a.appendChild(d)}),a.submit()}};var e=function(a){this.target=a,this.frameHandle=f(),this.frameHandle.init()};e.prototype={setTarget:function(a){if(!a)throw new Error("The parameter is incorrect");this.target=a},on:function(a,b){this.frameHandle["on"+a]=function(a){b(a)}},send:function(a){var b=this;b.frameHandle.postMessage(a,b.target)},emit:function(a,b){var c=this;c.frameHandle.postMessage({type:"event",eventName:a,param:b||{}},c.target)},fire:function(a,b){this.frameHandle.dispatchEvent(a,b)}};var f=function(){var b={DEBUG:!1,supportPostMessage:function(){if(window.postMessage)try{return window.postMessage.toString().indexOf("[native code]")>=0}catch(a){return!0}return!1}()};return function(){return{postMessage:function(d,e){return"object"==typeof d&&(d=c.stringify(d)),"string"==typeof d&&e?(this.sendMessage(d,e),void this.dispatchEvent("PostMessage",[d,e])):(this.dispatchEvent("Error",["发送的信息格式出现问题"]),void(b.DEBUG&&a.log("[WARN] the message is not a string type or the target window is not exist.")))},setEventDelegate:function(a){this.eventDelegate=a},eventDelegate:this,dispatchEvent:function(b,c){var d=this;return this.eventDelegate&&(d=this.eventDelegate),"function"==typeof d["on"+b]?(d.DEBUG&&a.log("[LOG] call the delegate function `on"+b+"` of the obj:",d," successful"),"[object Array]"===Object.prototype.toString.call(c)||"object"==typeof c&&c.length?d["on"+b].apply(d,c):d["on"+b].apply(d),d):(d.DEBUG&&a.log("[WARN] the delegate function `on"+b+"` of the crossDomainOuter is not a function"),!1)},bind:function(a,b,c){a&&"function"==typeof c&&(a.addEventListener?a.addEventListener(b,c,!1):a.attachEvent&&a.attachEvent("on"+b,c))},sendMessage:function(c,d){b.DEBUG&&a.log("[LOG] will send message to innerWindow:",d,", message is:",c),b.supportPostMessage?d.postMessage(c,"*"):d.name=c},init:function(){var a=this;this.eventDelegate=this;var d=function(b){"event"===b.type?a.dispatchEvent(b.eventName,[b.param]):a.dispatchEvent("Message",[b])};b.supportPostMessage?this.bind(window,"message",function(a){if(a.data){var b=c.parseJSON(a.data);d(b)}}):(window.name="",a.windowName=window.name,setInterval(function(){if(window.name!==a.windowName&&""!==window.name){a.windowName=window.name;var b=c.parseJSON(a.windowName);d(b),setTimeout(function(){window.name="",a.windowName=""},20)}},100))}}}}(),g=function(){var a=arguments;this.manger=new d,c.each(["Jsonp","CORS","Frame","FrameForm"],function(b){this[b]=this.manger["get"+b].apply(null,a)},this)},h=function(a){return this instanceof h?(this.data=a,void(this.queue=[])):new h(a)};h.prototype.pushVerify=function(){return[].push.apply(this.queue,arguments),this},h.prototype.start=function(){var a=this;c.each(this.queue,function(b){if(!b.verify.call(a.data))throw new Error("[VERIFY LOG] name: "+b.name+"; "+b.errorMsg||"验证出现错误,缺少失败原因")})};var i=new g,j=function(a){if(c.isObject(a)){var b={method:"get",type:"jsonp",data:{},success:function(){},url:"",contentType:"application/x-www-form-urlencoded",callbackName:"cb",withCredentials:!1,headers:{},targetWindow:window.frames[0]||window.top,cache:!1};switch(c.forIn(b,function(c){b[c]=a[c]||b[c]}),h(b).pushVerify({name:"验证method",verify:function(){return/^(get|post)$/gim.test(this.method)?"post"===this.method?!/^(jsonp|frame)$/.test(this.type):!0:void 0},errorMsg:"[ERROR:如使用post方法则不能使用以下方式进行跨域请求'jsonp,frame']"},{name:"验证type",verify:function(){return/^(jsonp|crossDomain|frame|formRequest)$/gim.test(this.type)},errorMsg:"[ERROR:只能使用以下方法方式进行跨域请求'jsonp,crossDoamin,frame,formRequest']"},{name:"验证url",verify:function(){return"get"===this.method&&/(jsonp|crossDomain|formRequest)/.test(this.type)&&(this.url=c.hasSearch(this.url,c.encodeObject2URIString(this.data)),this.data=void 0),!0}},{name:"验证cache",verify:function(){return this.cache===!1&&(this.url=c.hasSearch(this.url,"_="+parseInt(16777215*Math.random(),10))),!0}}).start(),b.type){case"jsonp":return i.Jsonp(b.url,b.data,b.callbackName,b.success);case"crossDomain":return i.CORS(b.method,b.url,b.data,b.success,{headers:b.headers,withCredentials:b.withCredentials});case"frame":return i.Frame(b.targetWindow);case"formRequest":return i.FrameForm(b.method,b.url,b.data,b.success,b.contentType)}}};return c.forIn({jsonp:"Jsonp",crossDomain:"CORS",frame:"Frame",formRequest:"FrameForm"},function(a,b){j[a]=function(){return i[b].apply(null,arguments)}}),j.version="0.9.0",j});