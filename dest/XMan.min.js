/*! xMan 2016-01-07 */
!function(a){"use strict";if("object"==typeof exports&&"undefined"!=typeof module)module.exports=a();else if("function"==typeof define&&define.amd)define([],a());else{var b;if("undefined"==typeof window)throw new Error("wrong execution environment");b=window,b.x=a()}}(function(){"use strict";var a=function(a){return function(b){return Object.prototype.toString.call(b)==="[object "+a+"]"}},b={encodeObject2URIString:function(a){if("string"==typeof a)return a;var b=[];for(var c in a)a.hasOwnProperty(c)&&"function"!=typeof a[c]&&b.push(encodeURIComponent(c)+"="+encodeURIComponent(a[c]));return b.join("&")},stringify:function(a){var c=typeof a,d=b.stringify;if("object"!==c||null===a)return"string"===c&&(a='"'+a+'"'),String(a);if("object"==typeof JSON&&JSON.stringify)return JSON.stringify(a);var e,f=[],g=a&&a.constructor===Array;for(var h in a)a.hasOwnProperty(h)&&(e=a[h],c=typeof e,"string"===c?e='"'+e+'"':"object"===c&&null!==e&&(e=d(e)),f.push((g?"":'"'+h+'":')+String(e)));return(g?"[":"{")+String(f)+(g?"]":"}")},parseJSON:function(a){var b=/^[\],:{}\s]*$/,c=/\\(?:["\\\/bfnrt]|u[0-9a-fA-F]{4})/g,d=/"[^"\\\n\r]*"|true|false|null|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?/g,e=/(?:^|:|,)(?:\s*\[)+/g;return"object"==typeof a?a:"string"==typeof a&&a?(a=a.replace(/(^\s+)|(\s+$)/g,""),b.test(a.replace(c,"@").replace(d,"]").replace(e,""))?window.JSON&&window.JSON.parse?window.JSON.parse(a):new Function("return "+a)():a):null},bind:function(a,b){return Function.prototype.bind?a.bind(b):function(){a.apply(b,arguments)}},hasSearch:function(a,b){var c="";return c=/\?/.test(a)?"&":"?",a+c+b},forIn:function(a,c){if(b.isObject(a))for(var d in a)a.hasOwnProperty(d)&&c.call(null,d,a[d])},each:function(){return[].forEach?function(a){[].forEach.apply(a,[].slice.call(arguments,1))}:function(a,b){for(var c=0,d=a.length;d>c;c++)b.call(arguments[2],a[c],c,a)}}(),init:function(){b.each(["Object","String","Function","Array"],function(c){b["is"+c]=a(c)})},isPureObject:function(a){return!(!b.isObject(a)||a.constructor!==Object)}};b.init();var c=function(){this.obtainId=function(){var a=0;return function(b){return(b||"obtainId_")+a++}}(),this.queue={}};c.prototype.getJsonp=function(){var a=this;return function(c,d,e,f){var g="cb"+a.obtainId(),h="window.x."+g,i=document.createElement("script");window.x[g]=function(a){try{f(a)}finally{delete window.x[g],i.parentNode.removeChild(i)}};var j="";b.isObject(d)&&(j=b.encodeObject2URIString(d)),j+=j.length>0?"&":"",i.src=b.hasSearch(c,j+e+"="+h),document.body.appendChild(i)}},c.prototype.getCORS=function(a){var c=function(){return"XMLHttpRequest"in window?"withCredentials"in new XMLHttpRequest?XMLHttpRequest:"XDomainRequest"in window?window.XDomainRequest:null:!1}();return function(a,d,e,f,g){if(c){b.isPureObject(e)&&(e=b.encodeObject2URIString(e)),"get"===String(a).toLowerCase()&&b.isString(e)&&e.length>0&&(d=b.hasSearch(d,e),e=void 0),g=g||{};var h=new c;h.open(a,d),b.forIn(g.headers,function(a,b){h.setRequestHeader(a,b)}),h.withCredentials=!!g.withCredentials,h.onload=function(){f(h.responseText)},h.send(e)}}},c.prototype.getFrame=function(){return function(a){return new d(a)}},c.prototype.createIframe=function(a){var b=null,c=this;try{b=document.createElement("<iframe name='"+a+"'>")}catch(d){b=document.createElement("iframe")}b.name=a,b.style.display="none",document.body.appendChild(b),b.onload=function(){var a=c.queue[b.name];if(a)try{a(b.contentWindow.name)}finally{b.parentNode.removeChild(b),delete c.queue[b.name]}}},c.prototype.getFrameForm=function(){var a=null,c=this;return function(d,e,f,g,h){null===a&&(a=document.createElement("form"),document.body.appendChild(a));var i=c.obtainId();c.createIframe(i),a.method=d,a.enctype=h||"application/x-www-form-urlencoded",a.setAttribute("target",i),a.action=e,c.queue[i]=g,a.innerHTML="",b.forIn(f,function(b,c){var d=document.createElement("input");d.type="hidden",d.name=b,d.value=c,a.appendChild(d)}),a.submit()}};var d=function(a){this.target=a,this.frameHandle=e(),this.frameHandle.init()};d.prototype={setTarget:function(a){if(!a)throw new Error("The parameter is incorrect");this.target=a},on:function(a,b){this.frameHandle["on"+a]=function(a){b(a)}},send:function(a){var b=this;b.frameHandle.postMessage(a,b.target)},emit:function(a,b){var c=this;c.frameHandle.postMessage({type:"event",eventName:a,param:b||{}},c.target)},fire:function(a,b){this.frameHandle.dispatchEvent(a,b)}};var e=function(){var a={DEBUG:!1,supportPostMessage:function(){if(window.postMessage)try{return window.postMessage.toString().indexOf("[native code]")>=0}catch(a){return!0}return!1}()};return function(){return{postMessage:function(a,c){return"object"==typeof a&&(a=b.stringify(a)),"string"==typeof a&&c?(this.sendMessage(a,c),void this.dispatchEvent("PostMessage",[a,c])):void this.dispatchEvent("Error",["发送的信息格式出现问题"])},setEventDelegate:function(a){this.eventDelegate=a},eventDelegate:this,dispatchEvent:function(a,b){var c=this;return this.eventDelegate&&(c=this.eventDelegate),"function"==typeof c["on"+a]?("[object Array]"===Object.prototype.toString.call(b)||"object"==typeof b&&b.length?c["on"+a].apply(c,b):c["on"+a].apply(c),c):!1},bind:function(a,b,c){a&&"function"==typeof c&&(a.addEventListener?a.addEventListener(b,c,!1):a.attachEvent&&a.attachEvent("on"+b,c))},sendMessage:function(b,c){a.supportPostMessage?c.postMessage(b,"*"):c.name=b},init:function(){var c=this;this.eventDelegate=this;var d=function(a){"event"===a.type?c.dispatchEvent(a.eventName,[a.param]):c.dispatchEvent("Message",[a])};a.supportPostMessage?this.bind(window,"message",function(a){if(a.data){var c=b.parseJSON(a.data);d(c)}}):(window.name="",c.windowName=window.name,setInterval(function(){if(window.name!==c.windowName&&""!==window.name){c.windowName=window.name;var a=b.parseJSON(c.windowName);d(a),setTimeout(function(){window.name="",c.windowName=""},20)}},100))}}}}(),f=function(){var a=arguments;this.manger=new c,b.each(["Jsonp","CORS","Frame","FrameForm"],function(b){this[b]=this.manger["get"+b].apply(null,a)},this)},g=function(a){return this instanceof g?(this.data=a,void(this.queue=[])):new g(a)};g.prototype.pushVerify=function(){return[].push.apply(this.queue,arguments),this},g.prototype.start=function(){var a=this;b.each(this.queue,function(b){if(!b.verify.call(a.data))throw new Error("[VERIFY LOG] name: "+b.name+"; "+b.errorMsg||"验证出现错误,缺少失败原因")})};var h=new f,i=function(a){if(!b.isObject(a))throw new TypeError("参数不正确");var c={method:"get",type:"jsonp",data:{},success:function(){},url:"",contentType:"application/x-www-form-urlencoded",callbackName:"cb",withCredentials:!1,headers:{},targetWindow:window.frames[0]||window.top,cache:!1};switch(b.forIn(c,function(b){c[b]=a[b]||c[b]}),g(c).pushVerify({name:"验证method",verify:function(){return/^(get|post)$/gim.test(this.method)?"post"===this.method?!/^(jsonp|frame)$/.test(this.type):!0:void 0},errorMsg:"[ERROR:如使用post方法则不能使用以下方式进行跨域请求'jsonp,frame']"},{name:"验证type",verify:function(){return/^(jsonp|crossDomain|frame|formRequest)$/gim.test(this.type)},errorMsg:"[ERROR:只能使用以下方法方式进行跨域请求'jsonp,crossDoamin,frame,formRequest']"},{name:"验证url",verify:function(){return"get"===this.method&&/(jsonp|crossDomain|formRequest)/.test(this.type)&&(this.url=b.hasSearch(this.url,b.encodeObject2URIString(this.data)),this.data=void 0),!0}},{name:"验证cache",verify:function(){return this.cache===!1&&(this.url=b.hasSearch(this.url,"_="+parseInt(16777215*Math.random(),10))),!0}}).start(),c.type.toLowerCase()){case"jsonp":return h.Jsonp(c.url,c.data,c.callbackName,c.success);case"crossdomain":return h.CORS(c.method,c.url,c.data,c.success,{headers:c.headers,withCredentials:c.withCredentials});case"frame":return h.Frame(c.targetWindow);case"formrequest":return h.FrameForm(c.method,c.url,c.data,c.success,c.contentType)}};return b.forIn({jsonp:"Jsonp",crossDomain:"CORS",frame:"Frame",formRequest:"FrameForm"},function(a,b){i[a]=function(){return h[b].apply(null,arguments)}}),i.version="0.9.0",i});